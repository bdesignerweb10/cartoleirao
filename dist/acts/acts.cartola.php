<?php
function sendRequest($path, $options = array()){ if($options['body']){ $c = curl_init(); curl_setopt($c, CURLOPT_SSL_VERIFYPEER, false); curl_setopt($c, CURLOPT_RETURNTRANSFER, true); curl_setopt($c, CURLOPT_URL, $options['base'] . $path); curl_setopt($c, CURLOPT_HTTPHEADER, array('Content-Type: application/json')); curl_setopt($c, CURLOPT_POST, true); curl_setopt($c, CURLOPT_POSTFIELDS, json_encode($options['body'])); $result = curl_exec($c); $httpCode = curl_getinfo($c, CURLINFO_HTTP_CODE); switch ($httpCode) { case 200: $error_status = "200: Success"; return ($result); break; case 404: $error_status = "404: API Not found"; break; case 500: $error_status = "500: servers replied with an error."; break; case 502: $error_status = "502: servers may be down or being upgraded. Hopefully they'll be OK soon!"; break; case 503: $error_status = "503: service unavailable. Hopefully they'll be OK soon!"; break; default: $error_status = "Undocumented error: " . $httpCode . " : " . curl_error($c); break; } curl_close($c); echo $error_status; die; } else if(isset($options['token'])){ if (isset($options["api"]) && $options["api"] === "liga") { $orderBy = ""; if (isset($options["orderBy"]) && $options["orderBy"] != "") { $orderBy = "?orderBy=". $options["orderBy"]; } $page = ""; if (isset($options["page"]) && $options["page"] != "") { if (!array_key_exists("orderBy", $options)) { $page = "?page=". $options["page"]; } else { $page = "&page=". $options["page"]; } } $url = "https://api.cartolafc.globo.com/auth/liga/". $options["liga_slug"] . $orderBy . $page; } else if (isset($options["api"]) && $options["api"] === "atleta-pontuacao") { $url = "https://api.cartolafc.globo.com/auth/mercado/atleta/". $options["atleta_id"] ."/pontuacao"; } else { $url = $options['base'] . $path; } $json = exec("curl -X GET ". $url ." -H 'x-glb-token: ". $options['token'] ."'"); return ($json); } else { $json = exec("curl -X GET " . $options['base'] . $path); return ($json); } } function login($login, $password){ $body = array('payload' => array( 'email' => $login, 'password' => $password, 'serviceId' => 4728 )); return json_decode(sendRequest('authentication', array( 'base' => 'https://login.globo.com/api/', 'body' => $body ))); } function api($path, $options = array()){ $opts = array( 'body' => false, 'base' => 'https://api.cartolafc.globo.com/' ); if(count($options) > 0) { $opts = $opts + $options; } if(strpos($path, "auth") !== FALSE) { $auth = login($opts["login"], $opts["senha"]); unset($opts["login"]); unset($opts["senha"]); $opts += array('token' => $auth->{"glbId"}); } $results = sendRequest($path, $opts); if(trim($results) == '404 page not found') { header('HTTP/1.0 404 Not Found'); } return json_decode($results); } ?>